function randomInt(t,e){return Math.floor(Math.random()*(e-t+1))+t}function shuffle(t){for(var e,i,n=t.length;0!==n;)i=Math.floor(Math.random()*n),e=t[n-=1],t[n]=t[i],t[i]=e;return t}var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Input;!function(t){!function(t){var e;!function(t){t[t.A=65]="A",t[t.D=68]="D",t[t.W=87]="W",t[t.S=83]="S",t[t.LEFT=37]="LEFT",t[t.RIGHT=39]="RIGHT",t[t.UP=38]="UP",t[t.DOWN=40]="DOWN",t[t.ENTER=13]="ENTER",t[t.SPACE=32]="SPACE",t[t.NUM_1=49]="NUM_1",t[t.NUM_2=50]="NUM_2",t[t.NUM_3=51]="NUM_3",t[t.NUM_4=52]="NUM_4",t[t.NUM_5=53]="NUM_5",t[t.C=67]="C"}(e=t.KEY||(t.KEY={}));var i;!function(t){t[t.UP=0]="UP",t[t.DOWN=1]="DOWN",t[t.LEFT=2]="LEFT",t[t.RIGHT=3]="RIGHT",t[t.ACTION=4]="ACTION"}(i=t.META_KEY||(t.META_KEY={})),t.KEY_BIND=[],t.KEY_BIND[i.UP]=[e.W,e.UP],t.KEY_BIND[i.DOWN]=[e.S,e.DOWN],t.KEY_BIND[i.LEFT]=[e.A,e.LEFT],t.KEY_BIND[i.RIGHT]=[e.D,e.RIGHT],t.KEY_BIND[i.ACTION]=[e.SPACE,e.ENTER];for(var n=[],s=[],r=[],a=0;a<256;a++)s[a]=!0;t.isDown=function(t){return n[t]},t.wasDown=function(t){var e=r[t];return r[t]=!1,e},t.clearInputQueue=function(){for(var t in r)r[t]=!1},t.keyDown=function(t){var e=t.which;n[e]=!0,s[e]&&(r[e]=!0),s[e]=!1},t.keyUp=function(t){var e=t.which;n[e]=!1,s[e]=!0},t.isBindDown=function(e){for(var i=!1,s=0,r=t.KEY_BIND[e];s<r.length;s++){var a=r[s];i=i||n[a]}return i},t.wasBindDown=function(e){for(var i=!1,n=0,s=t.KEY_BIND[e];n<s.length;n++){var a=s[n];i=i||r[a],r[a]=!1}return i}}(t.KB||(t.KB={}))}(Input||(Input={}));var Game=function(){function t(t,e,i){this._canvas=e,this._window=t,this._audioContext=i,ImageCache.Loader.add("sheet","./sheet.png"),ImageCache.Loader.load(this.init.bind(this))}return t.prototype.init=function(){this.engine=new Engine(this._canvas),this.bindings(),this.engine.gsm.register("main-menu",new MainMenu(this)),this.engine.gsm.register("game-screen",new GameScreen(this)),this.engine.gsm.push("main-menu"),this.engine.run()},t.prototype.bindings=function(){this._window.addEventListener("resize",this.onResize.bind(this),!1),this.onResize(),this._window.onkeydown=Input.KB.keyDown,this._window.onkeyup=Input.KB.keyUp,this._window.onblur=this.engine.pause.bind(this.engine),this._window.onfocus=this.engine.unpause.bind(this.engine),this.audioEngine=new AudioEngine(this._audioContext),SpriteSheetManager.storeSheet(new SpriteSheet("sheet","tiles",8,0,new Dm(5,1),new Pt(40,0)))},t.prototype.onResize=function(){var t=window.innerWidth/this._canvas.width,e=window.innerHeight/this._canvas.height,i=0|Math.min(t,e);i=i<=0?1:i;var n=[this._canvas.width*i,this._canvas.height*i],s=[(window.innerWidth-n[0])/2,(window.innerHeight-n[1])/2],r=document.getElementById("stage"),a="translate("+~~s[0]+"px, "+~~s[1]+"px) scale("+~~i+")";r.style.transform=a,r.style.webkitTransform=a},t}();!function(t){t.P_W=512,t.P_H=288,t.T_W=64,t.T_H=36,t.T_S=8}(Game||(Game={}));var GameState=function(){function t(t){this.game=t,this.redraw=!0,this.requestingClear=!1}return t.prototype.transitionIn=function(){this.redraw=!0,this.update(0)},t.prototype.transitionOut=function(){this.redraw=!0,this.update(0)},t}(),GameStateManager=function(){function t(){this.stateCollection={},this.stateStack=[]}return t.prototype.register=function(t,e){this.stateCollection[t]=e},Object.defineProperty(t.prototype,"current",{get:function(){return this.stateStack[this.stateStack.length-1]},enumerable:!0,configurable:!0}),t.prototype.push=function(t){this.current&&this.current.transitionOut(),this.stateStack.push(this.stateCollection[t]),this.current&&this.current.transitionIn()},t.prototype.pop=function(){this.current&&this.current.transitionOut(),this.stateStack.pop(),this.current&&this.current.transitionIn()},t}(),Engine=function(){function t(t){this.clearScreen=!1,this.redraw=!1,this.systemPause=!1,this.screen=t,this.ctx=this.screen.getContext("2d"),this.ctx.mozImageSmoothingEnabled=!1,this.ctx.imageSmoothingEnabled=!1,this.ctx.webkitImageSmoothingEnabled=!1,this.buffer=document.createElement("canvas"),this.buffer.width=this.screen.width,this.buffer.height=this.screen.height,this.bufferCtx=this.buffer.getContext("2d"),this.bufferCtx.mozImageSmoothingEnabled=!1,this.bufferCtx.imageSmoothingEnabled=!1,this.bufferCtx.webkitImageSmoothingEnabled=!1,this.gsm=new GameStateManager}return t.prototype.update=function(t){this.systemPause||this.gsm.current.update(t)},t.prototype.draw=function(){(this.clearScreen||this.gsm.current.requestingClear)&&(this.ctx.clearRect(0,0,this.screen.width,this.screen.height),this.bufferCtx.clearRect(0,0,this.screen.width,this.screen.height),this.clearScreen=this.gsm.current.requestingClear=!1),this.systemPause||!this.redraw&&!this.gsm.current.redraw?this.systemPause&&this.redraw&&(this.ctx.globalAlpha=.7,this.ctx.fillStyle="black",this.ctx.fillRect(0,0,Game.P_W,Game.P_H),this.ctx.globalAlpha=1,this.redraw=this.gsm.current.redraw=!1):(this.gsm.current.draw(this.bufferCtx),this.ctx.drawImage(this.buffer,0,0,Game.P_W,Game.P_H,0,0,Game.P_W,Game.P_H),this.redraw=this.gsm.current.redraw=!1)},t.prototype.loop=function(){var t=window.performance.now(),e=t-this.then;this.then=t,this.update(e),this.draw(),this.loopHandle=window.requestAnimationFrame(this.loop.bind(this))},t.prototype.run=function(){this.loopHandle=window.requestAnimationFrame(this.loop.bind(this))},t.prototype.stop=function(){window.cancelAnimationFrame(this.loopHandle)},t.prototype.pause=function(){this.systemPause=!0,this.redraw=!0},t.prototype.unpause=function(){this.systemPause=!1,this.gsm.current.redraw=this.clearScreen=!0},t}(),AudioEngine=function(){function t(t){this.audioContext=t}return t.prototype.beep=function(t){var e=this.audioContext,i=e.createOscillator(),n=e.createGain(),s=t.vol||1;i.type=t.shape,i.frequency.setValueAtTime(t.freq1,e.currentTime),i.frequency.exponentialRampToValueAtTime(t.freq2,e.currentTime+t.dur/2),i.frequency.exponentialRampToValueAtTime(t.freq1,e.currentTime+t.dur),n.gain.setValueAtTime(s,e.currentTime),n.gain.exponentialRampToValueAtTime(.001,e.currentTime+t.dur),i.connect(n),n.connect(e.destination),i.start(e.currentTime),i.stop(e.currentTime+t.dur)},t}(),Beep=function(){return function(t,e,i,n,s){this.freq1=t,this.freq2=e,this.shape=i,this.dur=n,this.vol=s}}(),Component=function(){return function(t){this.name=t}}(),Dm=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.w=t,this.h=e}return t.from=function(e,i){return new t(e,i)},t}(),Pt=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.from=function(e,i){return new t(e,i)},t}(),ECS;!function(t){var e=function(t){function e(e){var i=e.w,n=void 0===i?0:i,s=e.h,r=void 0===s?0:s,a=t.call(this,"aabb")||this;return a.value=new Dm(n,r),a}return __extends(e,t),e}(Component);t.AABB=e;var i=function(t){function e(e){var i=e.x,n=void 0===i?0:i,s=e.y,r=void 0===s?0:s,a=t.call(this,"position")||this;return a.value=new Pt(n,r),a}return __extends(e,t),e}(Component);t.Pos=i;var n=function(t){function e(e){var i=t.call(this,"style")||this;return i.value=e,i}return __extends(e,t),e}(Component);t.Style=n;var s=function(t){function e(e){var i=t.call(this,"sprite")||this;return i.value=e,i}return __extends(e,t),e}(Component);t.Sprite=s;var r=function(t){function e(e,i){var n=t.call(this,e)||this;return n.value=i,n}return __extends(e,t),e}(Component);t.Tag=r;var a=function(t){function e(e,i){var n=t.call(this,e)||this;return n.value=i,n}return __extends(e,t),e}(Component);t.Flag=a}(ECS||(ECS={}));var GameEntity=function(){function t(){return this.components={},t.autoID||(t.autoID=0),this.id=t.autoID++,this}return t.prototype.addComponent=function(t){return this.components[t.name]=t,this},t}(),ImageCache;!function(t){var e={};t.getTexture=function(t){return e[t]};var i={},n=0;!function(t){t.add=function(t,e){i[t]=e,n++},t.load=function(t){var s={counter:0,loadCount:0,callback:t};for(var r in i)e[r]=new Image,e[r].src=i[r],e[r].onload=function(t){t.counter++===t.loadCount&&t.callback()}.bind(this,s),delete i[r];n=0}}(t.Loader||(t.Loader={}))}(ImageCache||(ImageCache={}));var SpriteSheet=function(){function t(t,e,i,n,s,r){void 0===n&&(n=0),void 0===s&&(s=new Dm(0,0)),void 0===r&&(r=new Pt(0,0)),this.sprites=[],this.name=e,this.offset=r,this.subsheet=s,this.tileSize=i,this.gutter=n,this.image=ImageCache.getTexture(t),this.storeSprites()}return t.prototype.reColourize=function(t,e,i,n,s){for(var r=this.sprites[t].getContext("2d").getImageData(0,0,this.tileSize,this.tileSize),a=0;a<this.tileSize*this.tileSize*4;a+=4)r.data[a]=e||r.data[a],r.data[a+1]=i||r.data[a+1],r.data[a+2]=n||r.data[a+2],r.data[a+3]=s||r.data[a+3];var o=document.createElement("canvas");return o.width=o.height=this.tileSize,o.getContext("2d").putImageData(r,0,0),o},t.prototype.storeSprites=function(t){void 0===t&&(t=null),this.spritesPerRow=0===this.subsheet.w||0===this.subsheet.h?this.image.width/this.tileSize:this.subsheet.w,this.spritesPerCol=0===this.subsheet.w||0===this.subsheet.h?this.image.height/this.tileSize:this.subsheet.h;for(var e,i=0;i<this.spritesPerCol;i++)for(var n=0;n<this.spritesPerRow;n++)(e=this.sprites[n+i*this.spritesPerRow]=document.createElement("canvas")).getContext("2d").mozImageSmoothingEnabled=!1,e.getContext("2d").imageSmoothingEnabled=!1,e.width=this.tileSize,e.height=this.tileSize,e.getContext("2d").drawImage(this.image,(this.tileSize+this.gutter)*n+this.offset.x,(this.tileSize+this.gutter)*i+this.offset.y,this.tileSize,this.tileSize,0,0,this.tileSize,this.tileSize)},t}(),SpriteSheetManager;!function(t){var e={};t.storeSheet=function(t){e[t.name]=t},t.spriteSheet=function(t){return e[t]}}(SpriteSheetManager||(SpriteSheetManager={}));var Camera=function(){return function(t,e){this.p=t,this.s=e}}(),TMASK;!function(t){t.D=1,t.V=2,t.W=4,t.O=8,t.WALL=16,t.FLOOR=32}(TMASK||(TMASK={}));var Level=function(){function t(t){void 0===t&&(t=new Dm(50,50)),this.map=[],this.rerender=!0,this.s=t,this.renderCache=document.createElement("canvas"),this.renderCache.width=t.w*Game.T_S,this.renderCache.height=t.h*Game.T_S,this.renderCache.getContext("2d").mozImageSmoothingEnabled=!1,this.renderCache.getContext("2d").imageSmoothingEnabled=!1,this.generate()}return t.prototype.addEntity=function(t,e){t.components.position.value=e,this.entities.push(t)},t.prototype.calcOrigin=function(t,e){var i=e.w===WALL.N,n=e.w===WALL.S,s=e.w===WALL.E,r=e.w===WALL.W,a=e.p.x-(i||n?~~(t.s.w/2):0)+(s?1:0)-(r?t.s.w:0),o=e.p.y-(s||r?~~(t.s.h/2):0)+(i?0:n?1:0)-(i?t.s.h:0);return new Pt(a,o)},t.prototype.addDoor=function(t,e){this.map[e.p.x+e.p.y*this.s.h]=TMASK.FLOOR|TMASK.W,e.w===WALL.N||e.w===WALL.S?(this.map[e.p.x-1+e.p.y*this.s.h]=TMASK.WALL,this.map[e.p.x+1+e.p.y*this.s.h]=TMASK.WALL,this.map[e.p.x+(e.p.y-1)*this.s.h]=TMASK.FLOOR|TMASK.W,this.map[e.p.x+(e.p.y+1)*this.s.h]=TMASK.FLOOR|TMASK.W):(this.map[e.p.x-1+e.p.y*this.s.h]=TMASK.FLOOR|TMASK.W,this.map[e.p.x+1+e.p.y*this.s.h]=TMASK.FLOOR|TMASK.W,this.map[e.p.x+(e.p.y-1)*this.s.h]=TMASK.WALL,this.map[e.p.x+(e.p.y+1)*this.s.h]=TMASK.WALL)},t.prototype.scan=function(t,e){var i=!0,n=e.w===WALL.N,s=e.w===WALL.S,r=e.w===WALL.E,a=e.w===WALL.W,o=this.calcOrigin(t,e),h=o.x,u=o.y,c=t.s.w+(r||a?1:0),p=t.s.h+(n||s?1:0);i=h>0&&u>0&&h<this.s.w-t.s.w&&u<this.s.h-t.s.h;for(var l=h;l<h+c&&i;l++)for(var m=u;m<u+p&&i;m++)i=i&&void 0===this.map[l+m*this.s.h];return i},t.prototype.roomToMap=function(t,e){t.p.x=e.x,t.p.y=e.y;for(var i=e.x,n=0;n<t.s.w;n++){for(var s=e.y,r=0;r<t.s.h;r++)0===n||0===r||n===t.s.w-1||r===t.s.h-1?this.map[i+s*this.s.h]=TMASK.WALL:this.map[i+s*this.s.h]=TMASK.FLOOR|TMASK.W,s++;i++}},t.prototype.generate=function(){var t,e,i,n,s,r=[],a=new Pt;for(t=i=Room.makeRoom(25,25),a=new Pt(randomInt(0,this.s.w-t.s.w),randomInt(0,this.s.h-t.s.h)),r.push(t),this.roomToMap(t,a);r.length>0;){for(;i.w.length>0&&null!==(n=i.getRandomWall());)if(e=Room.makeCorridor(n.w===WALL.N||n.w===WALL.S),this.scan(e,n))for(a=this.calcOrigin(e,n),this.roomToMap(e,a),this.addDoor(e,n);e.w.length>0&&(t=Room.makeRoom(25,25),null!==(s=e.getRandomWall()));)this.scan(t,s)&&(a=this.calcOrigin(t,s),this.roomToMap(t,a),this.addDoor(t,s),r.push(t),i=t);r.length>1?(r.pop(),i=r[r.length-1]):r.pop()}},t.prototype.update=function(t){},t.prototype.render=function(t){var e=this;this.map.forEach(function(i,n){var s,r=~~(n/e.s.w),a=n%e.s.w;i?i&TMASK.WALL?s=SpriteSheetManager.spriteSheet("tiles").sprites[1]:i&TMASK.FLOOR&&(s=SpriteSheetManager.spriteSheet("tiles").sprites[0]):(t.fillStyle="#000000",t.fillRect(a*Game.T_S,r*Game.T_S,Game.T_S,Game.T_S)),s&&t.drawImage(s,0,0,Game.T_S,Game.T_S,~~(a*Game.T_S),~~(r*Game.T_S),Game.T_S,Game.T_S)})},t.prototype.draw=function(t,e){this.rerender&&(this.render(this.renderCache.getContext("2d")),this.rerender=!1),e.z?t.drawImage(this.renderCache,~~(e.p.x*Game.T_S),~~(e.p.y*Game.T_S),~~(Game.T_W*Game.T_S),~~(Game.T_H*Game.T_S),0,0,~~(Game.T_W*Game.T_S),~~(Game.T_H*Game.T_S)):t.drawImage(this.renderCache,~~(e.p.x*Game.T_S),~~(e.p.y*Game.T_S),~~(e.s.w*Game.T_S),~~(e.s.h*Game.T_S),0,0,~~((Game.T_W-12)*Game.T_S),~~((Game.T_H-8)*Game.T_S))},t}(),Light=function(){function t(t,e){this.p=t,this.i=.8,this.r=6}return t.prototype.calc=function(e,i){this.a=[];var n=t.poc(this.p.x,this.p.y,this.r);for(var s in n){var r=t.pol(this.p.x,this.p.y,n[s].x,n[s].y),a=this.i/r.length;for(var o in r){if(r[o].x<0||r[o].x>=i.w||r[o].y<0||r[o].y>=i.h)break;var h=r[o].y*i.w+r[o].x,u=a*(r.length-parseInt(o));if(h in this.a&&!(this.a[h]<u)||(this.a[h]=u>1?1:u),e[h]&TMASK.WALL)break}}},t.reLM=function(t,e){var i=[];for(var n in t)for(var s in t[n].a)(!i[s]||i[s]<t[n].a[s])&&(i[s]=t[n].a[s]);return i},t.pol=function(t,e,i,n){var s=[],r=Math.abs(i-t),a=Math.abs(n-e),o=t,h=e,u=1+r+a,c=t<i?1:-1,p=e<n?1:-1,l=r-a;for(r*=2,a*=2;u>0;)s.push(new Pt(o,h)),l>0?(o+=c,l-=a):(h+=p,l+=r),u-=1;return s},t.poc=function(t,e,i){for(var n=[],s=i,r=0,a=Math.floor(1-s);r<=s;)n.push(new Pt(s+t,r+e)),n.push(new Pt(r+t,s+e)),n.push(new Pt(-s+t,r+e)),n.push(new Pt(-r+t,s+e)),n.push(new Pt(-s+t,-r+e)),n.push(new Pt(-r+t,-s+e)),n.push(new Pt(s+t,-r+e)),n.push(new Pt(r+t,-s+e)),r+=1,a+=a<=0?2*r+1:2*(r-(s-=1))+1;return n},t}(),WALL;!function(t){t[t.N=0]="N",t[t.E=1]="E",t[t.S=2]="S",t[t.W=3]="W"}(WALL||(WALL={}));var ROOMTYPE;!function(t){t[t.CORRIDOR=0]="CORRIDOR",t[t.ROOM=1]="ROOM"}(ROOMTYPE||(ROOMTYPE={}));var Room=function(){function t(t,e,i,n){void 0===t&&(t=new Pt),void 0===e&&(e=new Dm),void 0===i&&(i=ROOMTYPE.ROOM),void 0===n&&(n=[WALL.N,WALL.E,WALL.S,WALL.W]),this.p=t,this.s=e,this.w=n,this.t=i,this.w=shuffle(this.w)}return t.prototype.getRandomWall=function(){if(0===this.w.length)return null;var t=this.w.pop(),e=new Pt;return t===WALL.N?(e.x=this.p.x+Math.floor(this.s.w/2),e.y=this.p.y-1):t===WALL.S?(e.x=this.p.x+Math.floor(this.s.w/2),e.y=this.p.y+this.s.h):t===WALL.W?(e.x=this.p.x-1,e.y=this.p.y+Math.floor(this.s.h/2)):t===WALL.E&&(e.x=this.p.x+this.s.w,e.y=this.p.y+Math.floor(this.s.h/2)),{p:e,w:t}},t.makeRoom=function(e,i){return new t(new Pt,new Dm(randomInt(7,e),randomInt(7,i)),ROOMTYPE.ROOM)},t.makeCorridor=function(e){return new t(new Pt,new Dm(e?5:randomInt(9,17),e?randomInt(9,17):5),ROOMTYPE.CORRIDOR)},t}(),GameScreen=function(t){function e(e){var i=t.call(this,e)||this;return i.camera=new Camera(new Pt,new Dm(26,14)),i.light=new Light(new Pt(13,7),.45),i.level=new Level(new Dm(250,250)),i}return __extends(e,t),e.prototype.transitionIn=function(){this.requestingClear=!0,t.prototype.transitionIn.call(this)},e.prototype.transitionOut=function(){t.prototype.transitionOut.call(this)},e.prototype.update=function(t){if(this.level.update(t),Input.KB.wasBindDown(Input.KB.META_KEY.ACTION)&&this.game.engine.gsm.pop(),Input.KB.isBindDown(Input.KB.META_KEY.UP)&&(this.camera.p.y--,this.light.p.y--,this.redraw=!0),Input.KB.isBindDown(Input.KB.META_KEY.DOWN)&&(this.camera.p.y++,this.light.p.y++,this.redraw=!0),Input.KB.isBindDown(Input.KB.META_KEY.LEFT)&&(this.camera.p.x--,this.light.p.x--,this.redraw=!0),Input.KB.isBindDown(Input.KB.META_KEY.RIGHT)&&(this.camera.p.x++,this.light.p.x++,this.redraw=!0),Input.KB.wasDown(Input.KB.KEY.C)&&(this.camera.z=!this.camera.z,this.redraw=!0),this.redraw){this.camera;this.light.calc(this.level.map,this.level.s),this.lightMap=Light.reLM([this.light],this.level.s)}this.requestingClear=this.redraw},e.prototype.draw=function(t){if(this.redraw){this.level.draw(t,this.camera),t.fillStyle="black";for(var e=this.camera.p.x,i=0;e<this.camera.p.x+this.camera.s.w;e++){for(var n=this.camera.p.y,s=0;n<this.camera.p.y+this.camera.s.h;n++){var r=this.lightMap[e+n*this.level.s.h];t.globalAlpha=1-(r||0),t.fillRect(i*Game.T_S*2,s*Game.T_S*2,2*Game.T_S,2*Game.T_S),s++}i++}t.globalAlpha=1,t.strokeStyle="red",t.strokeRect(13*Game.T_S*2,7*Game.T_S*2,2*Game.T_S,2*Game.T_S)}},e}(GameState),MainMenu=function(t){function e(e){var i=t.call(this,e)||this;return i.selectedIndex=0,i.menuOptions=["Start","Options","Exit"],i}return __extends(e,t),e.prototype.transitionIn=function(){this.requestingClear=!0,t.prototype.transitionIn.call(this)},e.prototype.transitionOut=function(){this.requestingClear=!0,t.prototype.transitionIn.call(this)},e.prototype.update=function(t){if(Input.KB.wasBindDown(Input.KB.META_KEY.ACTION))switch(this.selectedIndex){case 0:this.game.engine.gsm.push("game-screen");break;case 1:break;default:window.location.reload()}Input.KB.wasBindDown(Input.KB.META_KEY.DOWN)&&(this.selectedIndex=(this.selectedIndex+1)%this.menuOptions.length,this.redraw=this.requestingClear=!0),Input.KB.wasBindDown(Input.KB.META_KEY.UP)&&(0===this.selectedIndex?this.selectedIndex=this.menuOptions.length-1:this.selectedIndex=(this.selectedIndex-1)%3,this.redraw=this.requestingClear=!0)},e.prototype.draw=function(t){if(this.redraw){t.globalAlpha=1,t.font="18px Verdana",t.textAlign="center",t.fillStyle=t.strokeStyle="#DDDDDD",t.lineWidth=2,t.fillText("js13k 2017",~~(Game.P_W/2|0),64);for(var e=0;e<this.menuOptions.length;e++)t.fillText(this.menuOptions[e],~~(Game.P_W/2|0),~~((0|Game.P_H)-36*this.menuOptions.length+36*e));t.strokeRect(~~(Game.P_W/2-75),~~(Game.P_H-36*this.menuOptions.length+36*this.selectedIndex-18),150,24)}},e}(GameState);