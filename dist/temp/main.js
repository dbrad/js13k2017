window.onload=function(t){function e(){var t=new P;return t.addComponent(new K("pos")),t.addComponent(new K("move")),t.addComponent(new q("move",new A(50,5,"sine",.25,1))),t.addComponent(new U("move",125)),t.addComponent(new j(new Z(new M,.75,5))),t.addComponent(new H("input",!1)),t.addComponent(new G(D.spriteSheet("sprites").sprites[0])),t}function i(){var t=new P;return t.addComponent(new K("pos")),t.addComponent(new K("origin")),t.addComponent(new U("move",150)),t.addComponent(new j(new Z(new M,.35,7))),t.addComponent(new G(D.spriteSheet("guide").sprites[0])),t}function n(t,e){void 0===e&&(e=0);var i=new P;i.addComponent(new K("pos"));var n=new G(D.spriteSheet("marker").sprites[t]);return i.addComponent(new j(new Z(new M,.15,4))),n.r=e,i.addComponent(n),i}function s(t){var e=new P;return e.addComponent(new K("pos")),e.addComponent(new Y("type",t)),e.addComponent(new H("done",!1)),e}function o(){var t=new P;return t.addComponent(new K("pos")),t.addComponent(new H("active",!1)),t.addComponent(new G(D.spriteSheet("guide").sprites[1])),t.addComponent(new Y("type","switch")),t.addComponent(new q("interact",new A(1900,1,"square",.1,1))),t}function r(t){var e=new P;e.addComponent(new K("pos")),e.addComponent(new G(D.spriteSheet("objects").sprites[t])),e.addComponent(new q("collide",new A(50,5,"sine",.25,1)));var i=function(t){switch(t){case 0:return"exit";case 1:return"chest";case 2:return"gold";default:return"unknown"}}(t);return e.addComponent(new Y("type",i)),e}function a(t){var e,i=t.components["p-move"].value;return i.x=i.y=0,_.KB.isBindDown(_.KB.META_KEY.UP)&&(i.y-=1,e=!0),_.KB.isBindDown(_.KB.META_KEY.DOWN)&&(i.y+=1,e=!0),_.KB.isBindDown(_.KB.META_KEY.LEFT)&&(i.x-=1,e=!0),_.KB.isBindDown(_.KB.META_KEY.RIGHT)&&(i.x+=1,e=!0),e}function h(t){var e=O.gd.p.indexOf(t);-1!==e&&(O.gd.removePlayer(M.from(t.components["p-pos"].value)),delete O.gd.p[e],O.gd.players-=1)}function u(t){var e=t.components;e.active&&!1===e.active.value&&(e.active.value=!0,e.sprite.value=D.spriteSheet("guide").sprites[2],O.i.ae.beep(e["s-interact"].value),O.gd.addSpawner(s("guide"),M.from(e["p-pos"].value)))}function p(t){var n=t.components,s=M.from(n["p-pos"].value);switch(n.type.value){case"player":O.gd.addPlayer(e(),s);break;case"guide":O.gd.addGuide(i(),s)}var o=O.gd.s.indexOf(t);-1!==o&&delete O.gd.s[o]}function l(t){var e=O.gd.o.indexOf(t);if(-1!==e)switch(O.gd.removeObject(M.from(t.components["p-pos"].value)),delete O.gd.o[e],t.components.type.value){case"chest":O.gd.score+=1e5;break;case"gold":O.gd.score+=1e3}}function c(t,e){var i=t.components,n=i["p-pos"].value,s=i["p-move"].value,o=new M(s.x,s.y),r=!1;return e.m[n.x+s.x+(n.y+s.y)*e.s.w]&W.W&&!O.gd.playerAt(new M(n.x+s.x,n.y+s.y))||(s.x=s.y=0,r=!0),0!==o.x&&e.m[n.x+o.x+n.y*e.s.w]&W.W&&!O.gd.playerAt(new M(n.x+o.x,n.y))?(s.x=o.x,r=!1):0!==o.y&&e.m[n.x+(n.y+o.y)*e.s.w]&W.W&&!O.gd.playerAt(new M(n.x,n.y+o.y))&&(s.y=o.y,r=!1),r}function d(t){var e=t.components,i=e.sprite,n=e["p-move"].value;0===n.x&&0===n.y||(1===n.x?i.r+=90:-1===n.x?i.r-=90:-1!==n.y&&1!==n.y||i.r%180==0?-1!==n.y&&1!==n.y||i.r%180!=0||(i.r+=180):i.r=0,1===Math.abs(i.r%360)&&(i.r=0))}function f(t){var e=t.components,i=e["p-pos"],n=e["p-move"].value;if(0!==n.x||0!==n.y){var s=M.from(i.value);return i.value.x+=n.x,i.value.y+=n.y,O.gd.movePlayer(s,i.value),n.x=n.y=0,!0}return!1}function m(t){var e=t.components,i=O.gd.exit.components["p-pos"].value,n=e["p-pos"].value,s=i.x-n.x,o=i.y-n.y,r=Math.abs(s),a=Math.abs(o);0==s&&0==o?e["p-pos"].value=M.from(e["p-origin"].value):0!==r&&0!==a?(n.x+=s>0?1:-1,n.y+=o>0?1:-1):0!==r?n.x+=s>0?1:-1:0!==a&&(n.y+=o>0?1:-1);var h=e.sprite;h.r+=15,360==h.r&&(h.r=0)}function w(t,e,i){var n=e.components["p-pos"].value;if(n.x>=i.p.x&&n.x<i.p.x+i.s.w&&n.y>=i.p.y&&n.y<i.p.y+i.s.h){var s=e.components.sprite,o=s.value;t.save(),t.translate(~~((n.x-i.p.x)*O.T_S*2)+O.T_S,~~((n.y-i.p.y)*O.T_S*2)+O.T_S),t.rotate(s.r*Math.PI/180),t.drawImage(o,0,0,O.T_S,O.T_S,-O.T_S,-O.T_S,2*O.T_S,2*O.T_S),t.restore()}}function g(t,e,i,n,s){void 0===n&&(n=1),void 0===s&&(s=0),t.save(),t.translate(~~(i.x*O.T_S*n),~~(i.y*O.T_S*n)),t.rotate(s*Math.PI/180),t.drawImage(e,0,0,O.T_S,O.T_S,-O.T_S,-O.T_S,O.T_S*n,O.T_S*n),t.restore()}function y(t,e){return Math.floor(Math.random()*(e-t+1))+t}function v(t,e){void 0===e&&(e=!0);var i=t,n=e,s=x(i);return function(){if(0===s.length&&n)s=x(i);else if(0===s.length&&!n)return;return s.pop()}}function x(t){for(var e,i,n=t.length,s=t.slice();0!==n;)i=Math.floor(Math.random()*n),e=s[n-=1],s[n]=s[i],s[i]=e;return s}function b(t,e,i,n){return t.x>=e.x-n&&t.x<=e.x+i.w+n&&t.y>=e.y-10&&t.y<=e.y+i.h+n}var _,S=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();!function(t){!function(t){var e;!function(t){t[t.A=65]="A",t[t.D=68]="D",t[t.W=87]="W",t[t.S=83]="S",t[t.Z=90]="Z",t[t.LEFT=37]="LEFT",t[t.RIGHT=39]="RIGHT",t[t.UP=38]="UP",t[t.DOWN=40]="DOWN",t[t.ENTER=13]="ENTER",t[t.SPACE=32]="SPACE",t[t.NUM_1=49]="NUM_1",t[t.NUM_2=50]="NUM_2",t[t.NUM_3=51]="NUM_3",t[t.NUM_4=52]="NUM_4",t[t.NUM_5=53]="NUM_5",t[t.C=67]="C",t[t.ESC=27]="ESC"}(e=t.KEY||(t.KEY={}));var i;!function(t){t[t.UP=0]="UP",t[t.DOWN=1]="DOWN",t[t.LEFT=2]="LEFT",t[t.RIGHT=3]="RIGHT",t[t.ACTION=4]="ACTION"}(i=t.META_KEY||(t.META_KEY={})),t.KEY_BIND=[],t.KEY_BIND[i.UP]=[e.W,e.UP],t.KEY_BIND[i.DOWN]=[e.S,e.DOWN],t.KEY_BIND[i.LEFT]=[e.A,e.LEFT],t.KEY_BIND[i.RIGHT]=[e.D,e.RIGHT],t.KEY_BIND[i.ACTION]=[e.SPACE,e.ENTER];for(var n=[],s=[],o=[],r=0;r<256;r++)s[r]=!0;t.isDown=function(t){return n[t]},t.wasDown=function(t){var e=o[t];return o[t]=!1,e},t.clearInputQueue=function(){for(var t in o)o[t]=!1},t.keyDown=function(t){var e=t.which;n[e]=!0,s[e]&&(o[e]=!0),s[e]=!1},t.keyUp=function(t){var e=t.which;n[e]=!1,s[e]=!0},t.isBindDown=function(e){for(var i=!1,s=0,o=t.KEY_BIND[e];s<o.length;s++){var r=o[s];i=i||n[r]}return i},t.wasBindDown=function(e){for(var i=!1,n=0,s=t.KEY_BIND[e];n<s.length;n++){var r=s[n];i=i||o[r],o[r]=!1}return i}}(t.KB||(t.KB={}))}(_||(_={}));var O=function(){function t(){}return Object.defineProperty(t,"i",{get:function(){return t._i||(t._i=new t),t._i},enumerable:!0,configurable:!0}),Object.defineProperty(t,"gd",{get:function(){return t.i._gc||(t.i._gc=new F),t.i._gc},enumerable:!0,configurable:!0}),t.prototype.init=function(t,e,i){this._c=e,this._w=t,this._ac=i,T.Loader.add("sheet","./sheet.png"),T.Loader.load(this.done.bind(this))},t.prototype.done=function(){this.e=new k(this._c),this.bindings(),this.e.gsm.reg("main-menu",new it),this.e.gsm.reg("dialog",new tt),this.e.gsm.reg("game-screen",new et),this.e.gsm.reg("marker-menu",new nt),this.e.gsm.push("main-menu"),this.e.run()},t.prototype.bindings=function(){this._w.addEventListener("resize",this.onResize.bind(this),!1),this.onResize(),this._w.onkeydown=_.KB.keyDown,this._w.onkeyup=_.KB.keyUp,this._w.onblur=this.e.pause.bind(this.e),this._w.onfocus=this.e.unpause.bind(this.e),this.ae=new N(this._ac),D.storeSheet(new L("sheet","sprites",8,0,new R(5,1))),D.storeSheet(new L("sheet","marker",8,0,new R(2,1),new M(8,0))),D.storeSheet(new L("sheet","floor",8,0,new R(3,1),new M(24,0))),D.storeSheet(new L("sheet","wall",8,0,new R(4,1),new M(48,0))),D.storeSheet(new L("sheet","guide",8,0,new R(3,1),new M(0,8))),D.storeSheet(new L("sheet","objects",8,0,new R(3,1),new M(24,8)))},t.prototype.onResize=function(){var t=window.innerWidth/this._c.width,e=window.innerHeight/this._c.height,i=0|Math.min(t,e);i=i<=0?1:i;var n=[this._c.width*i,this._c.height*i],s=[(window.innerWidth-n[0])/2,(window.innerHeight-n[1])/2],o=document.getElementById("stage"),r="translate("+~~s[0]+"px, "+~~s[1]+"px) scale("+~~i+")";o.style.transform=r,o.style.webkitTransform=r},t}();!function(t){t.P_W=512,t.P_H=288,t.T_W=64,t.T_H=36,t.T_S=8}(O||(O={}));var T,E=function(){function t(){this.redraw=!0,this.requestingClear=!1}return t.prototype.transitionIn=function(){this.redraw=!0,this.update(0)},t.prototype.transitionOut=function(){},t}(),I=function(){function t(){this.stateCollection={},this.stateStack=[]}return t.prototype.reg=function(t,e){this.stateCollection[t]=e},Object.defineProperty(t.prototype,"cur",{get:function(){return this.stateStack[this.stateStack.length-1]},enumerable:!0,configurable:!0}),t.prototype.push=function(t){_.KB.clearInputQueue(),this.cur&&this.cur.transitionOut(),this.stateStack.push(this.stateCollection[t]),this.cur&&this.cur.transitionIn()},t.prototype.pop=function(){_.KB.clearInputQueue(),this.cur&&this.cur.transitionOut(),this.stateStack.pop(),this.cur&&this.cur.transitionIn()},t}(),k=function(){function t(t){this.clearScreen=!1,this.redraw=!1,this.systemPause=!1,this.screen=t,this.ctx=this.screen.getContext("2d"),this.ctx.mozImageSmoothingEnabled=!1,this.ctx.imageSmoothingEnabled=!1,this.ctx.webkitImageSmoothingEnabled=!1,this.buffer=document.createElement("canvas"),this.buffer.width=this.screen.width,this.buffer.height=this.screen.height,this.bufferCtx=this.buffer.getContext("2d"),this.bufferCtx.mozImageSmoothingEnabled=!1,this.bufferCtx.imageSmoothingEnabled=!1,this.bufferCtx.webkitImageSmoothingEnabled=!1,this.gsm=new I}return t.prototype.update=function(t){this.systemPause||this.gsm.cur.update(t)},t.prototype.draw=function(){(this.clearScreen||this.gsm.cur.requestingClear)&&(this.ctx.clearRect(0,0,this.screen.width,this.screen.height),this.bufferCtx.clearRect(0,0,this.screen.width,this.screen.height),this.clearScreen=this.gsm.cur.requestingClear=!1),this.systemPause||!this.redraw&&!this.gsm.cur.redraw||(this.bufferCtx.globalAlpha=1,this.bufferCtx.mozImageSmoothingEnabled=!1,this.bufferCtx.imageSmoothingEnabled=!1,this.bufferCtx.webkitImageSmoothingEnabled=!1,this.gsm.cur.draw(this.bufferCtx),this.ctx.globalAlpha=1,this.ctx.mozImageSmoothingEnabled=!1,this.ctx.imageSmoothingEnabled=!1,this.ctx.webkitImageSmoothingEnabled=!1,this.ctx.drawImage(this.buffer,0,0,O.P_W,O.P_H,0,0,O.P_W,O.P_H),this.redraw=this.gsm.cur.redraw=!1)},t.prototype.loop=function(){var t=window.performance.now(),e=t-this.then;this.then=t,this.update(e),this.draw(),this.loopHandle=window.requestAnimationFrame(this.loop.bind(this))},t.prototype.run=function(){this.loopHandle=window.requestAnimationFrame(this.loop.bind(this))},t.prototype.stop=function(){window.cancelAnimationFrame(this.loopHandle)},t.prototype.pause=function(){this.systemPause=!0},t.prototype.unpause=function(){this.systemPause=!1},t}(),N=function(){function t(t){this.audioContext=t}return t.prototype.beep=function(t){var e=this.audioContext,i=e.createOscillator(),n=e.createGain(),s=t.vol||1;i.type=t.shape,i.frequency.setValueAtTime(t.freq1,e.currentTime),i.frequency.exponentialRampToValueAtTime(t.freq2,e.currentTime+t.dur/2),i.frequency.exponentialRampToValueAtTime(t.freq1,e.currentTime+t.dur),n.gain.setValueAtTime(s,e.currentTime),n.gain.exponentialRampToValueAtTime(.001,e.currentTime+t.dur),i.connect(n),n.connect(e.destination),i.start(e.currentTime),i.stop(e.currentTime+t.dur)},t}(),A=function(){return function(t,e,i,n,s){this.freq1=t,this.freq2=e,this.shape=i,this.dur=n,this.vol=s}}(),C=function(){return function(t){this.name=t}}(),P=function(){function t(){return this.components={},t.autoID||(t.autoID=0),this.id=t.autoID++,this}return t.prototype.addComponent=function(t){return this.components[t.name]=t,this},t}();!function(t){var e={};t.getTexture=function(t){return e[t]};var i={},n=0;!function(t){t.add=function(t,e){i[t]=e,n++},t.load=function(t){var s={counter:0,loadCount:0,callback:t};for(var o in i)e[o]=new Image,e[o].src=i[o],e[o].onload=function(t){t.counter++===t.loadCount&&t.callback()}.bind(this,s),delete i[o];n=0}}(t.Loader||(t.Loader={}))}(T||(T={}));var D,M=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.from=function(e){var i=new t;return i.x=e.x,i.y=e.y,i},t}(),R=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.w=t,this.h=e}return t.from=function(e,i){return new t(e,i)},t}(),L=function(){function t(t,e,i,n,s,o){void 0===n&&(n=0),void 0===s&&(s=new R(0,0)),void 0===o&&(o=new M(0,0)),this.sprites=[],this.name=e,this.offset=o,this.subsheet=s,this.tileSize=i,this.gutter=n,this.image=T.getTexture(t),this.storeSprites()}return t.prototype.storeSprites=function(t){void 0===t&&(t=null),this.spritesPerRow=0===this.subsheet.w||0===this.subsheet.h?this.image.width/this.tileSize:this.subsheet.w,this.spritesPerCol=0===this.subsheet.w||0===this.subsheet.h?this.image.height/this.tileSize:this.subsheet.h;for(var e,i=0;i<this.spritesPerCol;i++)for(var n=0;n<this.spritesPerRow;n++){var s=(e=this.sprites[n+i*this.spritesPerRow]=document.createElement("canvas")).getContext("2d");s.mozImageSmoothingEnabled=s.webkitImageSmoothingEnabled=s.imageSmoothingEnabled=!1,e.width=this.tileSize,e.height=this.tileSize,s.drawImage(this.image,(this.tileSize+this.gutter)*n+this.offset.x,(this.tileSize+this.gutter)*i+this.offset.y,this.tileSize,this.tileSize,0,0,this.tileSize,this.tileSize)}},t}();!function(t){var e={};t.storeSheet=function(t){e[t.name]=t},t.spriteSheet=function(t){return e[t]}}(D||(D={}));var W,F=function(){function t(){this.p=[],this.m=[],this.o=[],this.s=[],this.g=[],this.lm=[],this.lights=[],this.score=0,this.t_score=0,this.players=0,this.playerInd=0,this.markers=0,this.P_OFF=26,this.O_OFF=16,this.M_OFF=8}return t.prototype.setupGame=function(t){var e,i,n;switch(t){case J.EASY:e=2,i=2,this.markers=10,n=new R(100,100);break;case J.NORMAL:e=2,i=4,this.markers=25,n=new R(175,175);break;case J.HARD:e=4,i=8,this.markers=50,n=new R(250,250);break;case J.VHARD:e=8,i=16,this.markers=100,n=new R(500,500);break;default:e=1,i=2,this.markers=10,n=new R(50,50)}this.players=e,this.playerInd=this.score=this.t_score=this.p.length=this.o.length=this.m.length=this.g.length=this.s.length=0,this.buildObjBank(e,i,n),this.l=new V(n),this.l.generate()},t.prototype.buildObjBank=function(t,e,i){for(var n=[0],s=~~(i.w*i.h*.001),o=~~(.25*(s-t-e)),r=~~(s-t-e-o),a=0;a<t;a++)n.push(1);for(a=0;a<e;a++)n.push(2);for(a=0;a<o;a++)n.push(3);for(a=0;a<r;a++)n.push(4);this.objectBank=v(n,!1)},t.prototype.addRandObj=function(t,e){var i=parseInt(this.objectBank()),n=new M(y(t.x+1,t.x+e.w-2),y(t.y+1,t.y+e.h-2));if(void 0!==i)switch(i){case 0:this.exit=r(0),this.addObject(this.exit,n);break;case 1:this.addSpawner(s("player"),n);break;case 2:this.addObject(o(),n);break;case 3:this.addObject(r(1),n),this.t_score+=1e5;break;default:this.addObject(r(2),n),this.t_score+=1e3}else this.addObject(r(2),n),this.t_score+=1e3},t.prototype.addGuide=function(t,e){t.components["p-pos"].value=e,t.components["p-origin"].value=M.from(e),this.g.push(t)},t.prototype.addSpawner=function(t,e){t.components["p-pos"].value=e,this.s.push(t)},t.prototype.addPlayer=function(t,e){t.components["p-pos"].value=e;var i=e.x+e.y*this.l.s.w;this.l.m[i]|=W.P;var n=this.p.push(t);this.l.m[i]|=n<<this.P_OFF},t.prototype.addObject=function(t,e){t.components["p-pos"].value=e;var i=e.x+e.y*this.l.s.w;this.l.m[i]|=W.O;var n=this.o.push(t);this.l.m[i]|=n<<this.O_OFF},t.prototype.addMarker=function(t,e){t.components["p-pos"].value=e;var i=e.x+e.y*this.l.s.w;this.l.m[i]|=W.M;var n=this.m.push(t);this.l.m[i]|=n<<this.M_OFF},t.prototype.movePlayer=function(t,e){if(this.l.m[t.x+t.y*this.l.s.w]){var i=(this.l.m[t.x+t.y*this.l.s.w]>>this.P_OFF)-1;this.removePlayer(t),void 0==this.l.m[e.x+e.y*this.l.s.w]&&(this.l.m[e.x+e.y*this.l.s.w]=0),this.l.m[e.x+e.y*this.l.s.w]|=i+1<<this.P_OFF,this.l.m[e.x+e.y*this.l.s.w]|=W.P}},t.prototype.removePlayer=function(t){this.l.m[t.x+t.y*this.l.s.w]&=~(15<<this.P_OFF),this.l.m[t.x+t.y*this.l.s.w]&=~W.P},t.prototype.removeMarker=function(t){this.l.m[t.x+t.y*this.l.s.w]&=~(255<<this.M_OFF),this.l.m[t.x+t.y*this.l.s.w]&=~W.M},t.prototype.removeObject=function(t){this.l.m[t.x+t.y*this.l.s.w]&=~(1023<<this.O_OFF),this.l.m[t.x+t.y*this.l.s.w]&=~W.O},t.prototype.playerAt=function(t){return 0!=(this.l.m[t.x+t.y*this.l.s.w]&W.P)},t.prototype.objectAt=function(t){return 0!=(this.l.m[t.x+t.y*this.l.s.w]&W.O)},t.prototype.markerAt=function(t){return 0!=(this.l.m[t.x+t.y*this.l.s.w]&W.M)},t.prototype.getObjectAt=function(t){if(this.objectAt(t)){var e=((this.l.m[t.x+t.y*this.l.s.w]&~(15<<this.P_OFF))>>this.O_OFF)-1;return O.gd.o[e]}},t.prototype.getMarkerIndex=function(t){if(this.markerAt(t))return((this.l.m[t.x+t.y*this.l.s.w]&~(16383<<this.O_OFF))>>this.M_OFF)-1},t.prototype.getCurrPlayer=function(){for(var t in this.p)if(this.p[t].components.input&&!0===this.p[t].components.input.value)return this.p[t]},t}(),B=function(){return function(t,e){this.p=t,this.s=e}}(),K=function(t){function e(e,i){void 0===i&&(i=new M);var n=t.call(this,"p-"+e)||this;return n.value=i,n}return S(e,t),e}(C),G=function(t){function e(e){var i=t.call(this,"sprite")||this;return i.r=0,i.value=e,i}return S(e,t),e}(C),Y=function(t){function e(e,i){var n=t.call(this,e)||this;return n.value=i,n}return S(e,t),e}(C),H=function(t){function e(e,i){var n=t.call(this,e)||this;return n.value=i,n}return S(e,t),e}(C),j=function(t){function e(e){var i=t.call(this,"light")||this;return i.value=e,i}return S(e,t),e}(C),q=function(t){function e(e,i){var n=t.call(this,"s-"+e)||this;return n.value=i,n}return S(e,t),e}(C),U=function(t){function e(e,i){var n=t.call(this,"t-"+e)||this;return n.cur=0,n.value=i,n}return S(e,t),e}(C);!function(t){t.W=1,t.O=2,t.M=4,t.P=8,t.FLOOR=16,t.WALL=32,t.S_WALL=64}(W||(W={}));var z,V=function(){function t(t){void 0===t&&(t=new R(50,50)),this.m=[],this.r=!0,this.s=t,this.rc=document.createElement("canvas"),this.rc.width=t.w*O.T_S,this.rc.height=t.h*O.T_S,this.ctx=this.rc.getContext("2d"),this.ctx.mozImageSmoothingEnabled=!1,this.ctx.webkitImageSmoothingEnabled=!1,this.ctx.imageSmoothingEnabled=!1}return t.prototype.calcOrigin=function(t,e){var i=e.w===Q.N,n=e.w===Q.S,s=e.w===Q.E,o=e.w===Q.W,r=e.p.x-(i||n?~~(t.s.w/2):0)+(s?1:0)-(o?t.s.w:0),a=e.p.y-(s||o?~~(t.s.h/2):0)+(i?0:n?1:0)-(i?t.s.h:0);return new M(r,a)},t.prototype.addDoor=function(t,e){this.m[e.p.x+e.p.y*this.s.h]=W.FLOOR|W.W,e.w===Q.N||e.w===Q.S?(this.m[e.p.x-1+e.p.y*this.s.h]=W.WALL|W.S_WALL,this.m[e.p.x+1+e.p.y*this.s.h]=W.WALL|W.S_WALL,this.m[e.p.x+(e.p.y-1)*this.s.h]=W.FLOOR|W.W,this.m[e.p.x+(e.p.y+1)*this.s.h]=W.FLOOR|W.W):(this.m[e.p.x-1+e.p.y*this.s.h]=W.FLOOR|W.W,this.m[e.p.x+1+e.p.y*this.s.h]=W.FLOOR|W.W,this.m[e.p.x+(e.p.y-1)*this.s.h]=W.WALL,this.m[e.p.x-1+(e.p.y-1)*this.s.h]=W.WALL,this.m[e.p.x+1+(e.p.y-1)*this.s.h]=W.WALL,this.m[e.p.x+(e.p.y+1)*this.s.h]=W.WALL|W.S_WALL)},t.prototype.scan=function(t,e){var i=!0,n=e.w===Q.N,s=e.w===Q.S,o=e.w===Q.E,r=e.w===Q.W,a=this.calcOrigin(t,e),h=a.x,u=a.y,p=t.s.w+(o||r?1:0),l=t.s.h+(n||s?1:0);i=h>0&&u>0&&h<this.s.w-t.s.w&&u<this.s.h-t.s.h;for(var c=h;c<h+p&&i;c++)for(var d=u;d<u+l&&i;d++)i=i&&void 0===this.m[c+d*this.s.h];return i},t.prototype.roomToMap=function(t,e){t.p.x=e.x,t.p.y=e.y;for(var i=e.x,n=0;n<t.s.w;n++){for(var s=e.y,o=0;o<t.s.h;o++)0===o&&0!==n&&n!==t.s.w-1?this.m[i+s*this.s.h]=W.WALL:0===n||0===o||n===t.s.w-1||o===t.s.h-1?this.m[i+s*this.s.h]=W.WALL|W.S_WALL:this.m[i+s*this.s.h]=W.FLOOR|W.W,s++;i++}},t.prototype.generate=function(){var t,e,i,n,s,o=[],r=new M;for(t=i=X.makeRoom(25,25),r=new M(y(0,this.s.w-t.s.w),y(0,this.s.h-t.s.h)),o.push(t),this.roomToMap(t,r),O.gd.addRandObj(r,t.s);o.length>0;){for(;i.w.length>0&&null!==(n=i.getRandomWall());)if(e=X.makeCorridor(n.w===Q.N||n.w===Q.S),this.scan(e,n))for(r=this.calcOrigin(e,n),this.roomToMap(e,r),this.addDoor(e,n);e.w.length>0&&(t=X.makeRoom(25,25),null!==(s=e.getRandomWall()));)this.scan(t,s)&&(r=this.calcOrigin(t,s),this.roomToMap(t,r),this.addDoor(t,s),O.gd.addRandObj(r,t.s),o.push(t),i=t);o.length>1?(o.pop(),i=o[o.length-1]):o.pop()}},t.prototype.render=function(t){var e=this,i=v([0,1,1,2]),n=v([0,0,0,0,0,0,1,2]);this.m.forEach(function(s,o){var r,a=~~(o/e.s.w),h=o%e.s.w;s?s&W.WALL?r=s&W.S_WALL?D.spriteSheet("wall").sprites[3]:D.spriteSheet("wall").sprites[i()]:s&W.FLOOR&&(r=D.spriteSheet("floor").sprites[n()]):(t.fillStyle="#000000",t.fillRect(h*O.T_S,a*O.T_S,O.T_S,O.T_S)),r&&t.drawImage(r,0,0,O.T_S,O.T_S,~~(h*O.T_S),~~(a*O.T_S),O.T_S,O.T_S)})},t.prototype.draw=function(t,e){this.r&&(this.render(this.ctx),this.r=!1),t.globalAlpha=1,t.drawImage(this.rc,~~(e.p.x*O.T_S),~~(e.p.y*O.T_S),~~(e.s.w*O.T_S),~~(e.s.h*O.T_S),0,0,~~(e.s.w*O.T_S*2),~~(e.s.h*O.T_S*2))},t}(),Z=function(){function t(t,e,i){this.p=t,this.i=e,this.r=i}return t.prototype.calc=function(e,i){this.a=[];var n=t.poc(this.p.x,this.p.y,this.r);for(var s in n){var o=t.pol(this.p.x,this.p.y,n[s].x,n[s].y),r=this.i/o.length,a=0;for(var h in o){if(o[h].x<0||o[h].x>=i.w||o[h].y<0||o[h].y>=i.h)break;var u=o[h].y*i.w+o[h].x,p=r*(o.length-parseInt(h));if(e[u]&W.FLOOR&&a>0)break;if(u in this.a&&!(this.a[u]>p)||(this.a[u]=1-(p>1?1:p)),e[u]&W.S_WALL)break;if(e[u]&W.WALL&&a>1)break;if(e[u]&W.WALL&&a++,!e[u])break}}},t.reLM=function(t,e){var i=[];for(var n in t)for(var s in t[n].a)(!i[s]||i[s]>t[n].a[s])&&(i[s]=t[n].a[s]);return i},t.pol=function(t,e,i,n){var s=[],o=Math.abs(i-t),r=Math.abs(n-e),a=t,h=e,u=1+o+r,p=t<i?1:-1,l=e<n?1:-1,c=o-r;for(o*=2,r*=2;u>0;)s.push(new M(a,h)),c>0?(a+=p,c-=r):(h+=l,c+=o),u-=1;return s},t.poc=function(t,e,i){for(var n=[],s=i,o=0,r=~~(1-s);o<=s;)n.push(new M(s+t,o+e)),n.push(new M(o+t,s+e)),n.push(new M(-s+t,o+e)),n.push(new M(-o+t,s+e)),n.push(new M(-s+t,-o+e)),n.push(new M(-o+t,-s+e)),n.push(new M(s+t,-o+e)),n.push(new M(o+t,-s+e)),o+=1,r+=r<=0?2*o+1:2*(o-(s-=1))+1;return n},t}();!function(t){t[t.OPENING=0]="OPENING",t[t.CONTROLS=1]="CONTROLS",t[t.ENDING_0=2]="ENDING_0",t[t.ENDING_1_24=3]="ENDING_1_24",t[t.ENDING_25_49=4]="ENDING_25_49",t[t.ENDING_50_74=5]="ENDING_50_74",t[t.ENDING_75_99=6]="ENDING_75_99",t[t.ENDING_100=7]="ENDING_100"}(z||(z={})),function(t){var e=[];e[t.OPENING]="Seeking fame and fortune, you have recently joined an ambitious team of explorers. Thanks to funding received from a mysterious group of investors, your team was able to set out to explore ancient ruins across the globe. It appears that luck is not on your side, however, as during the exploration you all got separated from each other. The wealth you obtain will only be useful if you live to see the light of day again.",e[t.CONTROLS]="WASD / ARROWS - Movement\nSPACE / ENTER - Open Marker Menu\nZ - Switch Team Member\n\nFind the exit, and lead your entire team back to the surface.\n(Don't forget to pickup some treasure along the way.)",e[t.ENDING_0]="You and your team make it out alive, but without a penny to show for your efforts. You receive a communication from the investor group recommending that if you cannot make their investment worthwhile, perhaps you should just stay lost in the ruins...",e[t.ENDING_1_24]="You and your team make it out with a few fist fulls of treasure. It's not much to write home about, but hopefully it is enough to convince everyone that it is worth the risk of trying again.",e[t.ENDING_25_49]="Your entire team makes it back to safety, and with modest about of loot in tow. It was a pay cheque well earned, but you know that this is just the tip of the iceberg.",e[t.ENDING_50_74]="Your team steps out into the light, happy to be free of that dusty prison. The weight of your bags acting as a reminder of why you took this risk in the first place. You all know there must have been more treasure to discover, but for today, this was more than enough.",e[t.ENDING_75_99]="Your team emerges from the ruins victorious, bags heavy with gold and jewels. The team looks forward to an evening of celebration and drinking, and the investor group looks forward to seeing a return on their investment.",e[t.ENDING_100]="The expedition was a resounding success. Not a speck of wealth was left behind in the ruins that tried to rob you of your life. The investor group is pleased with the performance of the team, and looks forward to future endeavours together.",t.getText=function(t){return e[t]}}(z||(z={}));var Q;!function(t){t[t.N=0]="N",t[t.E=1]="E",t[t.S=2]="S",t[t.W=3]="W"}(Q||(Q={}));var $;!function(t){t[t.CORRIDOR=0]="CORRIDOR",t[t.ROOM=1]="ROOM"}($||($={}));var J,X=function(){function t(t,e,i,n){void 0===t&&(t=new M),void 0===e&&(e=new R),void 0===i&&(i=$.ROOM),void 0===n&&(n=[Q.N,Q.E,Q.S,Q.W]),this.p=t,this.s=e,this.w=n,this.t=i,this.w=x(this.w)}return t.prototype.getRandomWall=function(){if(0===this.w.length)return null;var t=this.w.pop(),e=new M;return t===Q.N?(e.x=this.p.x+Math.floor(this.s.w/2),e.y=this.p.y-1):t===Q.S?(e.x=this.p.x+Math.floor(this.s.w/2),e.y=this.p.y+this.s.h):t===Q.W?(e.x=this.p.x-1,e.y=this.p.y+Math.floor(this.s.h/2)):t===Q.E&&(e.x=this.p.x+this.s.w,e.y=this.p.y+Math.floor(this.s.h/2)),{p:e,w:t}},t.makeRoom=function(e,i){return new t(new M,new R(y(7,e),y(7,i)),$.ROOM)},t.makeCorridor=function(e){return new t(new M,new R(e?5:y(9,17),e?y(9,17):5),$.CORRIDOR)},t}(),tt=function(t){function e(){return t.call(this)||this}return S(e,t),e.prototype.transitionIn=function(){t.prototype.transitionIn.call(this)},e.prototype.transitionOut=function(){t.prototype.transitionOut.call(this)},e.prototype.update=function(t){_.KB.wasBindDown(_.KB.META_KEY.ACTION)&&O.i.e.gsm.pop()},e.prototype.draw=function(t){if(this.redraw){t.globalAlpha=.6,t.fillStyle="black",t.fillRect(64,64,~~(O.P_W-128),~~(O.P_H-128)),t.globalAlpha=1,t.fillStyle="white",t.textAlign="left",t.font="10px consolas";var e=88;if(O.gd.message!=z.CONTROLS){for(var i=z.getText(O.gd.message).split(" "),n="",s=0;s<i.length;s++){var o=n+i[s]+" ";t.measureText(o).width>~~(O.P_W-152)&&s>0?(t.fillText(n,80,e),n=i[s]+" ",e+=16):n=o}t.fillText(n,80,e)}else for(var r=z.getText(O.gd.message).split("\n"),s=0;s<r.length;s++)t.fillText(r[s],80,e),e+=16;t.textAlign="right",t.fillText("Press SPACE / ENTER to continue...",~~(O.P_W-72),~~(O.P_H-72)),t.strokeStyle="white",t.strokeRect(64,64,~~(O.P_W-128),~~(O.P_H-128)),this.redraw=!1}},e}(E);!function(t){t[t.EASY=0]="EASY",t[t.NORMAL=1]="NORMAL",t[t.HARD=2]="HARD",t[t.VHARD=3]="VHARD"}(J||(J={}));var et=function(t){function e(){var e=t.call(this)||this;return e.boop=new A(545,550,"sawtooth",.25,1),e.doooom=new A(100,100,"sine",5,.95),e.mt=0,e.ma=1,e.md=-.15,e.c=new B(new M,new R(32,17)),e}return S(e,t),e.prototype.transitionIn=function(){this.requestingClear=!0,t.prototype.transitionIn.call(this)},e.prototype.transitionOut=function(){t.prototype.transitionOut.call(this)},e.prototype.update=function(t){this.mt+=t,this.mt>=250&&(this.mt=0,this.ma+=this.md,(this.ma>=1||this.ma<=.55)&&(this.md*=-1),this.redraw=!0);for(var e in O.gd.s)p(O.gd.s[e]);if(O.gd.players<=0){O.i.e.gsm.pop();var i=O.gd.score/O.gd.t_score;O.gd.message=i>0&&i<.25?z.ENDING_1_24:i>=.25&&i<.5?z.ENDING_25_49:i>=.5&&i<.75?z.ENDING_50_74:i>=.75&&i<.99?z.ENDING_75_99:1==i?z.ENDING_100:z.ENDING_0,O.i.ae.beep(this.doooom),O.i.e.gsm.push("dialog")}for(var e in O.gd.p){var n=O.gd.p[e].components,s=O.gd.p[e];if(!O.gd.getCurrPlayer()){n.input.value=!0;E=M.from(O.gd.getCurrPlayer().components["p-pos"].value);this.c.p.x=E.x-~~(this.c.s.w/2),this.c.p.y=E.y-~~(this.c.s.h/2)}if(n.input&&n.input.value&&n["t-move"]&&((w=n["t-move"]).cur+=t,w.cur>=w.value&&n["p-move"]&&a(s)&&(w.cur=0,n["p-pos"]&&!c(s,O.gd.l)&&(n.sprite&&d(s),f(s))))){this.redraw=!0;E=n["p-pos"].value;if(this.c.p.x=E.x-~~(this.c.s.w/2),this.c.p.y=E.y-~~(this.c.s.h/2),O.gd.objectAt(E)){var o=O.gd.getObjectAt(E);switch(o.components.type.value){case"gold":O.i.ae.beep(new A(2500,2500,"square",.75,1)),l(o);break;case"chest":O.i.ae.beep(new A(635,3,"square",.1,1)),l(o);break;case"switch":u(o);break;case"exit":O.i.ae.beep(new A(335,3,"square",.1,1)),h(s)}}else n["s-move"]&&O.i.ae.beep(n["s-move"].value)}}for(var e in O.gd.g){var n=O.gd.g[e].components,r=O.gd.g[e],w=n["t-move"];w.cur+=t,w.cur>=w.value&&(w.cur=0,m(r),this.redraw=!0)}if(this.redraw){O.gd.lights.length=0;for(var e in O.gd.p)(n=O.gd.p[e].components).light&&n["p-pos"]&&b(n["p-pos"].value,this.c.p,this.c.s,10)&&((g=n.light.value).p=n["p-pos"].value,g.calc(O.gd.l.m,O.gd.l.s),O.gd.lights.push(g));for(var e in O.gd.g)(n=O.gd.g[e].components).light&&n["p-pos"]&&b(n["p-pos"].value,this.c.p,this.c.s,10)&&((g=n.light.value).p=n["p-pos"].value,g.calc(O.gd.l.m,O.gd.l.s),O.gd.lights.push(g));for(var e in O.gd.m)if((n=O.gd.m[e].components).light&&n["p-pos"]&&b(n["p-pos"].value,this.c.p,this.c.s,10)){var g=n.light.value;g.p=n["p-pos"].value,g.calc(O.gd.l.m,O.gd.l.s),O.gd.lights.push(g)}O.gd.lights.length>0&&(O.gd.lm=Z.reLM(O.gd.lights,O.gd.l.s))}if(_.KB.wasBindDown(_.KB.META_KEY.ACTION)&&(O.i.e.gsm.push("marker-menu"),O.i.ae.beep(this.boop)),_.KB.wasDown(_.KB.KEY.Z)){var y=null,v=0,x=!1,S=null;for(var T in O.gd.p){if(v++,null===y&&(y=parseInt(T)),x){S=parseInt(T);break}x=parseInt(T)==O.gd.playerInd}if(null===S&&v>1&&(S=y),null!==S){O.gd.getCurrPlayer().components.input.value=!1,O.gd.playerInd=S,O.gd.p[S].components.input.value=!0;var E=M.from(O.gd.getCurrPlayer().components["p-pos"].value);this.c.p.x=E.x-~~(this.c.s.w/2),this.c.p.y=E.y-~~(this.c.s.h/2),O.i.ae.beep(new A(800,900,"square",.5,1)),this.redraw=!0}}this.redraw||O.gd.opShown?this.redraw||O.gd.ctrlShown||(O.gd.message=z.CONTROLS,O.i.e.gsm.push("dialog"),O.gd.ctrlShown=!0):(O.gd.message=z.OPENING,O.i.e.gsm.push("dialog"),O.gd.opShown=!0),this.requestingClear=this.redraw},e.prototype.draw=function(t){var e=this;if(this.redraw){O.gd.l.draw(t,this.c),t.globalAlpha=this.ma,O.gd.m.forEach(function(i){w(t,i,e.c)}),t.globalAlpha=1,O.gd.o.forEach(function(i){w(t,i,e.c)}),O.gd.p.forEach(function(i){w(t,i,e.c)}),t.globalAlpha=.3,O.gd.g.forEach(function(i){w(t,i,e.c)}),t.globalAlpha=1,t.fillStyle="#0d0d0d",t.fillRect(0,17*O.T_S*2,O.P_W,2*O.T_S),t.fillStyle="white",t.textAlign="left",t.font="11px helvetica",g(t,D.spriteSheet("marker").sprites[0],new M(.5,17.5),2),g(t,D.spriteSheet("marker").sprites[1],new M(1.5,17.5),2),t.fillText(" x "+O.gd.markers,4*O.T_S,O.P_H-4);var i=0;for(var n in O.gd.p)g(t,D.spriteSheet("sprites").sprites[0],new M(4.5+1*i,17.5),2),i++;if(t.textAlign="right",t.fillText("$"+O.gd.score.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),O.P_W-4,O.P_H-4),O.gd.lm.length>0){t.fillStyle="#0d0d0d";for(var s=this.c.p.x,o=0;s<this.c.p.x+this.c.s.w;s++){for(var r=this.c.p.y,a=0;r<this.c.p.y+this.c.s.h;r++){var h=O.gd.lm[s+r*O.gd.l.s.h];t.globalAlpha=h||1,t.fillRect(o*O.T_S*2,a*O.T_S*2,2*O.T_S,2*O.T_S),a++}o++}t.globalAlpha=1}}},e}(E),it=function(t){function e(){var e=t.call(this)||this;return e.selectedIndex=0,e.subIndex=0,e.menuOptions=["New Game","Reload"],e.subMenuOptions=["Easy","Normal","Lost","Forsaken"],e.bip=new A(1050,1050,"sawtooth",.25,1),e.doooom=new A(30,30,"square",1.5,.1),e.boop=new A(495,495,"square",.25,1),e}return S(e,t),e.prototype.transitionIn=function(){this.requestingClear=!0,this.selectedIndex=0,this.subMenu=!1,this.subIndex=0,t.prototype.transitionIn.call(this),O.i.ae.beep(this.doooom)},e.prototype.transitionOut=function(){this.requestingClear=!0,t.prototype.transitionOut.call(this)},e.prototype.update=function(t){if(_.KB.wasDown(_.KB.KEY.ESC))this.subMenu=!1,this.redraw=!0;else if(_.KB.wasBindDown(_.KB.META_KEY.ACTION)){if(this.subMenu){switch(this.subIndex){case 0:O.gd.setupGame(J.EASY);break;case 1:O.gd.setupGame(J.NORMAL);break;case 2:O.gd.setupGame(J.HARD);break;case 3:O.gd.setupGame(J.VHARD);break;default:O.gd.setupGame(J.EASY)}O.i.e.gsm.push("game-screen")}else switch(this.selectedIndex){case 0:this.subMenu=!0,this.redraw=!0;break;default:window.location.reload()}O.i.ae.beep(this.boop)}_.KB.wasBindDown(_.KB.META_KEY.DOWN)&&(this.subMenu?this.subIndex=(this.subIndex+1)%this.subMenuOptions.length:this.selectedIndex=(this.selectedIndex+1)%this.menuOptions.length,O.i.ae.beep(this.bip),this.redraw=!0),_.KB.wasBindDown(_.KB.META_KEY.UP)&&(this.subMenu?0===this.subIndex?this.subIndex=this.subMenuOptions.length-1:this.subIndex=(this.subIndex-1)%this.subMenuOptions.length:0===this.selectedIndex?this.selectedIndex=this.menuOptions.length-1:this.selectedIndex=(this.selectedIndex-1)%this.menuOptions.length,O.i.ae.beep(this.bip),this.redraw=!0),this.requestingClear=this.redraw},e.prototype.draw=function(t){if(this.redraw)if(t.globalAlpha=1,t.textAlign="center",t.fillStyle=t.strokeStyle="#DDDDDD",t.lineWidth=2,t.font="30px helvetica",t.fillStyle="#b71d1d",t.fillText("FORSAKEN",~~(O.P_W/2|0),64),t.font="11px helvetica",t.fillStyle="#3f3f3f",t.fillText("FAME. FORTUNE. FREEDOM.",~~(O.P_W/2|0),74),t.font="12px helvetica",t.fillText("js13k 2017 entry by David Brad",~~(O.P_W/2|0),~~(O.P_H-5)),t.fillStyle="#e8e8e8",this.subMenu){for(e=0;e<this.subMenuOptions.length;e++)t.fillText(this.subMenuOptions[e],~~(O.P_W/2|0),~~((0|O.P_H)-36*this.subMenuOptions.length+36*e)-16);t.strokeRect(~~(O.P_W/2-55),~~(O.P_H-36*this.subMenuOptions.length+36*this.subIndex-32),110,24)}else{for(var e=0;e<this.menuOptions.length;e++)t.fillText(this.menuOptions[e],~~(O.P_W/2|0),~~((0|O.P_H)-36*this.menuOptions.length+36*e)-16);t.strokeRect(~~(O.P_W/2-55),~~(O.P_H-36*this.menuOptions.length+36*this.selectedIndex-32),110,24)}},e}(E),nt=function(t){function e(){var e=t.call(this)||this;return e.selectedIndex=0,e.bip=new A(1050,1050,"sawtooth",.25,1),e.boop=new A(495,495,"square",.25,1),e}return S(e,t),e.prototype.transitionIn=function(){this.selectedIndex=5,t.prototype.transitionIn.call(this)},e.prototype.transitionOut=function(){t.prototype.transitionOut.call(this)},e.prototype.update=function(t){if(_.KB.wasDown(_.KB.KEY.ESC)&&O.i.e.gsm.pop(),_.KB.wasBindDown(_.KB.META_KEY.ACTION)){var e=M.from(O.gd.getCurrPlayer().components["p-pos"].value),i=O.gd.getMarkerIndex(e);if(void 0!==i&&(delete O.gd.m[i],O.gd.removeMarker(e),O.gd.markers+=1),5!==this.selectedIndex&&O.gd.markers>0){var s=n(4===this.selectedIndex?1:0,90*this.selectedIndex);O.gd.addMarker(s,e),O.gd.markers-=1}O.i.ae.beep(this.boop),O.i.e.gsm.pop()}_.KB.wasBindDown(_.KB.META_KEY.RIGHT)&&(this.selectedIndex=(this.selectedIndex+1)%6,O.i.ae.beep(this.bip),this.redraw=!0),_.KB.wasBindDown(_.KB.META_KEY.LEFT)&&(0===this.selectedIndex?this.selectedIndex=5:this.selectedIndex=(this.selectedIndex-1)%6,O.i.ae.beep(this.bip),this.redraw=!0)},e.prototype.draw=function(t){this.redraw&&(t.globalAlpha=1,t.fillStyle="black",t.fillRect(128,112,~~(O.P_W-256),~~(O.P_H-240)),t.globalAlpha=1,g(t,D.spriteSheet("marker").sprites[0],new M(10,9),2),g(t,D.spriteSheet("marker").sprites[0],new M(12,9),2,90),g(t,D.spriteSheet("marker").sprites[0],new M(14,9),2,180),g(t,D.spriteSheet("marker").sprites[0],new M(16,9),2,270),g(t,D.spriteSheet("marker").sprites[1],new M(18,9),2),t.font="11px helvetica",t.textAlign="left",t.fillStyle="#FFFFFF",t.fillText("PICKUP",4+~~(39*O.T_S),~~(18.5*O.T_S)),t.textAlign="center",t.fillStyle="#FFFFFF",t.fillText("PLACE A MARKER",~~(32*O.T_S),~~(15.5*O.T_S)),t.strokeStyle="green",t.lineWidth=2,t.strokeRect((19+4*this.selectedIndex)*O.T_S-2,17*O.T_S-2,4+(5===this.selectedIndex?6*O.T_S:2*O.T_S),2*O.T_S+4))},e}(E),st=new(window.AudioContext||window.webkitAudioContext);O.i.init(window,document.getElementById("gameCanvas"),st)};